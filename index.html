<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI Paper Trading Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .logo h1 {
            font-size: 24px;
            color: var(--text);
        }
        
        .logo span {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: var(--primary-dark);
        }
        
        .last-update {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Stats Grid - P&L and Invested gets more space */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        /* Highlight P&L card */
        .stat-card.highlight {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
        }
        
        .stat-card.highlight .stat-label {
            color: rgba(255,255,255,0.9);
        }
        
        .stat-card.highlight .stat-value {
            color: white;
        }
        
        .stat-card.highlight.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .stat-card.small {
            padding: 14px;
        }
        
        .stat-card.small .stat-label {
            font-size: 11px;
        }
        
        .stat-card.small .stat-value {
            font-size: 16px;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }
        
        .stat-card.highlight:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.3);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .stat-value.success { color: var(--success); }
        .stat-value.danger { color: var(--danger); }
        
        .stat-change {
            font-size: 13px;
            margin-top: 4px;
        }
        
        /* Section */
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge {
            background: var(--success);
            color: white;
            font-size: 12px;
            padding: 2px 10px;
            border-radius: 20px;
        }
        
        /* Positions */
        .positions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .position-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: center;
        }
        
        .position-info h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .position-info .meta {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .position-info .meta span {
            margin-right: 16px;
        }
        
        .position-price {
            text-align: center;
        }
        
        .position-price .current {
            font-size: 20px;
            font-weight: 600;
        }
        
        .position-pnl {
            text-align: right;
        }
        
        .position-pnl .value {
            font-size: 20px;
            font-weight: 600;
        }
        
        .position-pnl .value.success { color: var(--success); }
        .position-pnl .value.danger { color: var(--danger); }
        
        .position-pnl .percent {
            font-size: 13px;
        }
        
        .position-targets {
            display: flex;
            gap: 16px;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .target { color: var(--success); }
        .sl { color: var(--danger); }
        
        /* Trades Table */
        .trades-table {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .trades-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .trades-table th {
            background: #f1f5f9;
            padding: 14px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .trades-table td {
            padding: 14px 16px;
            border-top: 1px solid var(--border);
            font-size: 14px;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge.target { background: #d1fae5; color: #065f46; }
        .status-badge.sl { background: #fee2e2; color: #991b1b; }
        
        /* Empty State */
        .empty-state {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 48px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 24px;
            color: var(--text-secondary);
            font-size: 13px;
            border-top: 1px solid var(--border);
            margin-top: 32px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .position-card {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .position-price, .position-pnl {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">K</div>
                <div>
                    <h1>KAI Paper Trading</h1>
                    <span>Indian Stock Market</span>
                </div>
            </div>
            <div class="header-right">
                <span class="last-update" id="last">Last updated:Update --</span>
                <button class="refresh-btn" onclick="fetchData()">â†» Refresh</button>
            </div>
        </header>
        
        <!-- Stats - P&L only -->
        <div class="stats-grid">
            <div class="stat-card highlight" id="pnlCard">
                <div class="stat-label">Today's P&L</div>
                <div class="stat-value" id="totalPnl">---</div>
                <div class="stat-value" style="font-size: 16px; opacity: 0.9;" id="totalPnlPct">---</div>
            </div>
        </div>
        
        <!-- Invested Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Invested Portfolio</h2>
                <span id="investedAmount" style="font-size: 28px; font-weight: 700; color: var(--primary);">---</span>
            </div>
        </div>
        
        <!-- Open Positions -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    Open Positions 
                    <span class="badge" id="positionCount">0</span>
                </h2>
            </div>
            <div class="positions-list" id="positionsList">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading positions...
                </div>
            </div>
        </div>
        
        <!-- Trade History -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Trade History</h2>
            </div>
            <div class="trades-table" id="tradesTable">
                <div class="empty-state">
                    <div class="empty-icon">ðŸ“Š</div>
                    <p>No closed trades yet</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>ðŸš€ KAI Paper Trading | Data refreshes every 30 seconds</p>
        </footer>
    </div>
    
    <script>
        // Fetch from GitHub Gist (public)
        const GIST_ID = '147693f46ebe896b56e4adba857b5574';
        
        let cachedData = JSON.parse(localStorage.getItem('kaiTradingData') || 'null');
        
        // Demo data for initial display
        const demoData = {
        capital: 100000,
        balance: 81000,
        positions: [
            {
                symbol: 'INDUSINDBK',
                entry_price: 958,
                current_price: 959,
                qty: 9.4,
                cost: 9000,
                target: 1073,
                stop_loss: 910,
                pnl: 11,
                pnl_pct: 0.12
            }
        ],
        trades: []
    };
        
        function formatCurrency(amount) {
            return 'â‚¹' + Math.abs(amount || 0).toLocaleString('en-IN', { maximumFractionDigits: 0 });
        }
        
        function formatPrice(price) {
            return 'â‚¹' + (price || 0).toLocaleString('en-IN', { maximumFractionDigits: 2 });
        }
        
        async function fetchData() {
            // Try to fetch from GitHub Gist
            try {
                const url = 'https://gist.githubusercontent.com/Anand200530/147693f46ebe896b56e4adba857b5574/raw/trading_data.json?v=27';
                const response = await fetch(url);
                if (response.ok) {
                    const data = await response.json();
                    cachedData = data;
                    localStorage.setItem('kaiTradingData', JSON.stringify(cachedData));
                }
            } catch (e) {
                console.log('Using cached data', e);
            }
            
            // Use demo data if no API
            const data = cachedData || demoData;
            renderDashboard(data);
        }
        
        function renderDashboard(data) {
            // Update stats
            document.getElementById('capital').textContent = formatCurrency(data.capital);
            document.getElementById('cash').textContent = formatCurrency(data.balance);
            
            let invested = 0;
            let totalPnl = 0;
            
            // Positions
            const positionsList = document.getElementById('positionsList');
            document.getElementById('positionCount').textContent = data.positions?.length || 0;
            
            if (data.positions && data.positions.length > 0) {
                invested = data.positions.reduce((sum, p) => sum + (p.cost || 0), 0);
                totalPnl = data.positions.reduce((sum, p) => sum + (p.pnl || 0), 0);
                
                positionsList.innerHTML = data.positions.map(pos => {
                    const pnlClass = (pos.pnl || 0) >= 0 ? 'success' : 'danger';
                    const pnlSign = (pos.pnl || 0) >= 0 ? '+' : '';
                    
                    return `
                        <div class="position-card">
                            <div class="position-info">
                                <h3>${pos.symbol}</h3>
                                <div class="meta">
                                    <span>Bought @ ${formatPrice(pos.entry_price)}</span>
                                    <span>Qty: ${(pos.qty || 0).toFixed(2)}</span>
                                </div>
                                <div class="position-targets">
                                    <span class="target">Target: ${formatPrice(pos.target)}</span>
                                    <span class="sl">SL: ${formatPrice(pos.stop_loss)}</span>
                                </div>
                            </div>
                            <div class="position-price">
                                <div class="current">${formatPrice(pos.current_price || pos.entry_price)}</div>
                            </div>
                            <div class="position-pnl">
                                <div class="value ${pnlClass}">${pnlSign}${formatCurrency(pos.pnl)}</div>
                                <div class="percent ${pnlClass}">${pnlSign}${(pos.pnl_pct || 0).toFixed(2)}%</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                positionsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ“ˆ</div>
                        <p>No open positions</p>
                    </div>
                `;
            }
            
            document.getElementById('investedAmount').textContent = formatCurrency(invested);
            
            const pnlEl = document.getElementById('totalPnl');
            const pnlSign = totalPnl >= 0 ? '+' : '';
            pnlEl.textContent = pnlSign + formatCurrency(totalPnl);
            
            // Calculate and display percentage
            const pnlPctEl = document.getElementById('totalPnlPct');
            if (invested > 0) {
                const pnlPct = (totalPnl / invested) * 100;
                pnlPctEl.textContent = pnlSign + pnlPct.toFixed(2) + '%';
            } else {
                pnlPctEl.textContent = '0%';
            }
            
            // Update P&L card style based on profit/loss
            const pnlCard = document.getElementById('pnlCard');
            if (totalPnl >= 0) {
                pnlCard.className = 'stat-card highlight';
            } else {
                pnlCard.className = 'stat-card highlight danger';
            }
            
            // Trades
            const tradesTable = document.getElementById('tradesTable');
            if (data.trades && data.trades.length > 0) {
                tradesTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Stock</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Status</th>
                                <th>P&L</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.trades.slice(-10).reverse().map(trade => `
                                <tr>
                                    <td><strong>${trade.symbol}</strong></td>
                                    <td>${formatPrice(trade.entry_price)}</td>
                                    <td>${formatPrice(trade.exit_price || 0)}</td>
                                    <td><span class="status-badge ${trade.status?.toLowerCase()}">${trade.status}</span></td>
                                    <td class="${trade.pnl >= 0 ? 'success' : 'danger'}" style="color: ${trade.pnl >= 0 ? 'var(--success)' : 'var(--danger)'}">
                                        ${trade.pnl >= 0 ? '+' : ''}${formatCurrency(trade.pnl)}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            // Update time
            document.getElementById('lastUpdate').textContent = 'Last updated: ' + new Date().toLocaleString();
        }
        
        // Initial load
        fetchData();
        
        // Auto-refresh every 30 seconds
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
