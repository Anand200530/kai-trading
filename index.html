<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI Paper Trading</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 24px 0; border-bottom: 1px solid #30363d; margin-bottom: 24px; }
        h1 { font-size: 28px; color: #58a6ff; }
        .last-update { color: #8b949e; font-size: 14px; }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .stat-card { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-label { color: #8b949e; font-size: 12px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 28px; font-weight: 600; }
        .green { color: #3fb950; }
        .red { color: #f85149; }
        
        h2 { font-size: 18px; margin-bottom: 16px; color: #c9d1d9; display: flex; align-items: center; gap: 8px; }
        .badge { background: #238636; color: #fff; font-size: 12px; padding: 2px 8px; border-radius: 12px; }
        
        .positions { margin-bottom: 32px; }
        .position-card { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 12px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .position-info h3 { font-size: 18px; color: #58a6ff; margin-bottom: 6px; }
        .position-info .meta { color: #8b949e; font-size: 14px; }
        .position-info .meta span { margin-right: 16px; }
        .position-price { text-align: right; }
        .position-price .price { font-size: 22px; font-weight: 600; }
        .position-price .change { font-size: 14px; margin-top: 4px; }
        
        .target-sl { display: flex; gap: 20px; margin-top: 10px; font-size: 13px; }
        .target-sl span { color: #8b949e; }
        .target { color: #3fb950; }
        .sl { color: #f85149; }
        
        .trade-card { background: #161b22; border: 1px solid #30363d; padding: 14px 20px; border-radius: 8px; margin-bottom: 8px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 10px; font-size: 14px; align-items: center; }
        .trade-card .symbol { color: #58a6ff; font-weight: 500; }
        .trade-card .side-buy { color: #3fb950; }
        .trade-card .side-sell { color: #f85149; }
        .trade-card .status-sl { color: #f85149; }
        .trade-card .status-target { color: #3fb950; }
        
        .empty { text-align: center; color: #8b949e; padding: 40px; background: #161b22; border: 1px solid #30363d; border-radius: 12px; }
        
        footer { text-align: center; color: #8b949e; padding: 24px; font-size: 13px; border-top: 1px solid #30363d; margin-top: 32px; }
        
        .loading { text-align: center; padding: 40px; color: #8b949e; }
        
        @media (max-width: 700px) {
            .stats { grid-template-columns: repeat(2, 1fr); }
            .trade-card { grid-template-columns: 1fr 1fr 1fr; }
            .trade-card .exit-price, .trade-card .pnl { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>KAI Paper Trading</h1>
            <span class="last-update">Auto-refresh: 30s</span>
        </header>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Capital</div>
                <div class="stat-value" id="capital">---</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Cash</div>
                <div class="stat-value" id="cash">---</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Invested</div>
                <div class="stat-value" id="invested">---</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total P&L</div>
                <div class="stat-value" id="total-pnl">---</div>
            </div>
        </div>
        
        <div class="positions">
            <h2>Open Positions <span class="badge" id="pos-count">0</span></h2>
            <div id="positions-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
        
        <div class="trades">
            <h2>Trade History</h2>
            <div id="trades-list">
                <div class="empty">No closed trades yet</div>
            </div>
        </div>
        
        <footer>
            <p>KAI Paper Trading Dashboard | Data refreshed every 30 seconds</p>
            <p>GitHub Pages Deployment</p>
        </footer>
    </div>
    
    <script>
        // Configuration - change this to your API endpoint
        const API_URL = 'https://api.jsonbin.io/v3/b/YOUR_BIN_ID/latest';
        
        // Fallback: use localStorage cache
        let cachedData = JSON.parse(localStorage.getItem('kai_trading_data') || 'null');
        
        async function fetchData() {
            try {
                const response = await fetch(API_URL, { headers: { 'X-Access-Key': 'YOUR_API_KEY' }});
                if (!response.ok) throw new Error('API unavailable');
                const data = await response.json();
                localStorage.setItem('kai_trading_data', JSON.stringify(data));
                return data.record;
            } catch (e) {
                console.log('Using cached data');
                return cachedData;
            }
        }
        
        function formatCurrency(amount) {
            return '₹' + Math.abs(amount).toLocaleString('en-IN', { maximumFractionDigits: 0 });
        }
        
        function formatNumber(num) {
            return num.toLocaleString('en-IN', { maximumFractionDigits: 2 });
        }
        
        function renderDashboard(data) {
            if (!data) return;
            
            document.getElementById('capital').textContent = formatCurrency(data.capital);
            document.getElementById('cash').textContent = formatCurrency(data.balance);
            
            let invested = 0;
            let openPnl = 0;
            
            // Render positions
            const posList = document.getElementById('positions-list');
            document.getElementById('pos-count').textContent = data.positions?.length || 0;
            
            if (data.positions && data.positions.length > 0) {
                posList.innerHTML = data.positions.map(pos => {
                    invested += pos.cost || 0;
                    const pnl = pos.pnl || 0;
                    openPnl += pnl;
                    const pnlClass = pnl >= 0 ? 'green' : 'red';
                    const pnlSign = pnl >= 0 ? '+' : '';
                    const pnlPct = pos.pnl_pct || 0;
                    
                    return `
                        <div class="position-card">
                            <div class="position-info">
                                <h3>${pos.symbol}</h3>
                                <div class="meta">
                                    <span>Bought @ ₹${formatNumber(pos.entry_price)}</span>
                                    <span>Qty: ${formatNumber(pos.qty)}</span>
                                </div>
                                <div class="target-sl">
                                    <span class="target">Target: ₹${formatNumber(pos.target)}</span>
                                    <span class="sl">SL: ₹${formatNumber(pos.stop_loss)}</span>
                                </div>
                            </div>
                            <div class="position-price">
                                <div class="price">₹${formatNumber(pos.current_price || pos.entry_price)}</div>
                                <div class="change ${pnlClass}">${pnlSign}₹${formatNumber(Math.abs(pnl))} (${pnlSign}${pnlPct.toFixed(1)}%)</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                posList.innerHTML = '<div class="empty">No open positions</div>';
            }
            
            document.getElementById('invested').textContent = formatCurrency(invested);
            
            const totalPnl = openPnl;
            const pnlEl = document.getElementById('total-pnl');
            pnlEl.textContent = (totalPnl >= 0 ? '+' : '-') + formatCurrency(totalPnl);
            pnlEl.className = 'stat-value ' + (totalPnl >= 0 ? 'green' : 'red');
            
            // Render trades
            const tradesList = document.getElementById('trades-list');
            if (data.trades && data.trades.length > 0) {
                tradesList.innerHTML = data.trades.slice(-10).reverse().map(trade => `
                    <div class="trade-card">
                        <div class="symbol">${trade.symbol}</div>
                        <div class="side-${trade.side.toLowerCase()}">${trade.side}</div>
                        <div>₹${formatNumber(trade.entry_price)}</div>
                        <div>₹${formatNumber(trade.exit_price || 0)}</div>
                        <div class="status-${trade.status.toLowerCase()}">${trade.status}</div>
                        <div class="${trade.pnl >= 0 ? 'green' : 'red'}">${trade.pnl >= 0 ? '+' : ''}₹${formatNumber(trade.pnl)}</div>
                    </div>
                `).join('');
            } else {
                tradesList.innerHTML = '<div class="empty">No closed trades yet</div>';
            }
            
            // Update timestamp
            document.querySelector('.last-update').textContent = 'Updated: ' + new Date().toLocaleString();
        }
        
        // Initial render
        if (cachedData) renderDashboard(cachedData);
        
        // Auto-refresh
        setInterval(async () => {
            const data = await fetchData();
            renderDashboard(data);
        }, 30000);
    </script>
</body>
</html>
