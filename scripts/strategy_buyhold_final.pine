// =====================================================
// NIFTY 50 - BUY & HOLD (MONTHLY SIP)
// =====================================================
// @version=5
// Timeframe: Daily
// Instrument: Nifty 50 (^NSEI)

// This strategy implements a Monthly SIP approach:
// - Buy 10% of portfolio on first trading day of each month
// - Hold forever (no exits)
// - Builds full position over 10 months

strategy("Nifty 50 Buy & Hold (SIP)", 
     overlay=true, 
     default_qty_type=strategy.cash,
     default_qty_value=100000,
     pyramiding=10)

// ========================
// PARAMETERS
// ========================

sipPercent = input.float(10.0, title="SIP % per Month", minval=1, maxval=50)
maxMonths = input.int(10, title="Max Months to Buy", minval=1, maxval=120)

// ========================
// VARIABLES
// ========================

var int buyCount = 0
var int lastMonth = na
var bool canBuy = true

// ========================
// SESSION & TIME
// ========================

// Check if it's first bar of month
currentMonth = month(time)
isNewMonth = currentMonth != lastMonth

if isNewMonth
    lastMonth := currentMonth
    
    if buyCount < maxMonths
        canBuy := true
    else
        canBuy := false

// ========================
// ENTRY LOGIC
// ========================

// Buy on first day of month if under max months
if isNewMonth and canBuy and (buyCount < maxMonths)
    // Calculate position size (10% of current portfolio value)
    positionSize = (strategy.equity * (sipPercent / 100)) / close
    
    // Use qty_type percent_of_equity to automatically calculate
    // We'll use strategy.entry with percentage
    strategy.entry(id="SIP " + str.tostring(buyCount + 1), direction=strategy.long)
    buyCount := buyCount + 1
    canBuy := false

// ========================
// NO EXIT LOGIC - HOLD FOREVER
// ========================

// This strategy NEVER sells - it's a long-term hold

// ========================
// PLOTS
// ========================

// Show buy signals
plotshape(isNewMonth and canBuy and (buyCount < maxMonths), 
     title="SIP Buy", 
     location=location.belowbar, 
     color=color.blue, 
     style=shape.triangleup, 
     size=size.tiny, 
     text="SIP")

// ========================
// DASHBOARD
// ========================

var table dashboard = table.new(position.top_right, 2, 4, bgcolor=color.new(color.black, 80), border_color=color.gray)

if barstate.islast
    table.cell(dashboard, 0, 0, "SIP Buys:", text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 0, str.tostring(buyCount) + "/" + str.tostring(maxMonths), text_color=color.green, text_size=size.small)
    
    table.cell(dashboard, 0, 1, "Equity:", text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 1, str.format("${0,number,#,##0}", strategy.equity), text_color=color.yellow, text_size=size.small)
    
    table.cell(dashboard, 0, 2, "Position:", text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 2, str.tostring(strategy.position_size), text_color=strategy.position_size > 0 ? color.green : color.gray, text_size=size.small)
    
    table.cell(dashboard, 0, 3, "Value:", text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 3, str.format("${0,number,#,##0}", strategy.portfolio_value), text_color=color.blue, text_size=size.small)

// ========================
// INFO
// ========================

// Plot equity line
plot(strategy.equity, title="Equity", color=color.green, linewidth=2)

// ========================
// ALERTS
// ========================

alertcondition(isNewMonth and canBuy and (buyCount < maxMonths), 
     title="SIP Buy Alert", 
     message="NIFTY SIP: New monthly purchase")

// =====================================================
// NOTE: This strategy works best on DAILY timeframe
// It buys on the first trading day of each month
// and holds forever for long-term wealth creation
// =====================================================
